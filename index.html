<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Root Planner 2026 PRO</title>
<style>
:root{--bg:#0a1929;--panel:#1a2942;--border:#2d3e55;--muted:#8b9eb8;--text:#e8f0f8;--accent:#4fc3f7;--ok:#4ade80;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,sans-serif;background:#0a1929;color:var(--text);font-size:13px}
header{position:sticky;top:0;background:rgba(10,25,41,0.95);border-bottom:2px solid var(--border);padding:12px 24px;display:flex;align-items:center;gap:12px;z-index:100;backdrop-filter:blur(10px)}
.logo{font-size:2.8rem;line-height:1;filter:drop-shadow(0 3px 6px rgba(0,0,0,0.4))}
h1{font-size:1.2rem;font-weight:800;color:var(--accent)}
button{background:var(--accent);color:#001830;border:none;padding:10px 18px;border-radius:10px;font-weight:700;cursor:pointer;font-size:0.9rem;transition:all 0.2s}
button:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(79,195,247,0.4)}
.ghost{background:transparent;color:var(--muted);border:1px solid var(--border)}
.ghost:hover{background:var(--panel);color:var(--text)}
.actions{margin-left:auto;display:flex;gap:8px;position:relative}
.lang-dropdown{position:relative}
.lang-btn{display:flex;align-items:center;gap:8px}
.lang-menu{display:none;position:absolute;top:100%;right:0;margin-top:8px;background:var(--panel);border:1px solid var(--border);border-radius:10px;min-width:200px;box-shadow:0 8px 24px rgba(0,0,0,0.4);z-index:200}
.lang-menu.show{display:block}
.lang-option{display:flex;align-items:center;gap:10px;padding:12px 16px;cursor:pointer;transition:all 0.2s;border-bottom:1px solid var(--border)}
.lang-option:last-child{border-bottom:none}
.lang-option:hover{background:rgba(79,195,247,0.1)}
.lang-option.active{background:rgba(79,195,247,0.15)}
.flag{width:24px;height:18px;object-fit:cover;border-radius:3px;display:inline-block}
.main{display:grid;grid-template-columns:380px 1fr 440px;gap:20px;padding:20px;max-width:2400px;margin:0 auto}
.col{display:flex;flex-direction:column;gap:16px;max-height:calc(100vh - 96px);overflow-y:auto}
.card{background:#162030;border:1px solid var(--border);border-radius:12px;padding:16px}
h3{color:var(--accent);font-size:0.9rem;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.input-group{margin-bottom:16px;padding:4px 0}
.input-group.active{background:rgba(79,195,247,0.05);border-radius:8px;padding:8px}
.input-head{display:flex;justify-content:space-between;margin-bottom:8px}
.input-label{color:var(--muted);font-size:0.85rem}
.val{color:var(--accent);font-weight:800}
.val.neg{color:var(--bad)}
input[type=range]{width:100%;height:14px;border-radius:8px;background:var(--panel);border:1px solid var(--border);margin:8px 0;cursor:pointer;touch-action:pan-y;pointer-events:auto}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:grab;border:2px solid #001830;touch-action:none}
input[type=range]::-webkit-slider-thumb:active{cursor:grabbing;transform:scale(1.1)}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:grab;border:2px solid #001830;touch-action:none}
.kpi{background:rgba(79,195,247,0.05);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:12px}
.kpi .label{font-size:0.72rem;color:var(--muted);margin-bottom:6px;text-transform:uppercase;letter-spacing:0.3px}
.kpi .big{font-size:1.2rem;font-weight:900;color:var(--accent)}
.kpi .small{font-size:0.7rem;color:var(--muted);margin-top:4px}
.kpi.pos .big{color:var(--ok)}
.kpi.neg .big{color:var(--bad)}
.cities{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:12px}
.city-chip{background:#1a2535;border:3px solid var(--border);padding:12px;border-radius:10px;cursor:pointer;transition:all 0.2s}
.city-chip:hover{border-color:var(--accent);transform:translateY(-2px)}
.city-chip.active{border-color:var(--accent);background:rgba(79,195,247,0.1)}
.city-chip.ok{border-color:var(--ok)}
.city-chip.warn{border-color:var(--warn)}
.city-chip.bad{border-color:var(--bad)}
.city-name{font-weight:800;font-size:0.95rem;margin-bottom:6px;display:flex;align-items:center;gap:8px}
.city-info{font-size:0.75rem;color:var(--muted);margin-top:3px}
.city-km{font-size:0.7rem;color:var(--ok);margin-top:2px;font-weight:600}
table{width:100%;border-collapse:collapse;font-size:0.85rem}
thead{background:#1a2942;position:sticky;top:0;z-index:5}
th{padding:12px 8px;text-align:left;color:var(--accent);border-bottom:2px solid var(--accent);font-size:0.72rem;text-transform:uppercase;letter-spacing:0.3px}
td{padding:10px 8px;border-bottom:1px solid var(--border)}
tbody tr{cursor:pointer;transition:all 0.2s}
tbody tr:hover{background:rgba(79,195,247,0.05)}
tr.sel{background:rgba(79,195,247,0.15)}
tr.top{background:rgba(74,222,128,0.06)}
.uber{display:block}
.gen{display:none}
body.gm .uber{display:none}
body.gm .gen{display:block}
.badge{background:rgba(79,195,247,0.3);color:var(--accent);font-size:0.65rem;padding:2px 6px;border-radius:4px;font-weight:700;margin-left:6px}
.tog{display:flex;align-items:center;gap:10px;background:var(--panel);padding:12px;border-radius:8px;margin-bottom:16px;cursor:pointer;border:2px solid var(--border)}
.tog:hover{background:rgba(79,195,247,0.05);border-color:var(--accent)}
.tog input{width:50px;height:26px;appearance:none;background:var(--border);border-radius:13px;position:relative;cursor:pointer;transition:all 0.3s}
.tog input:checked{background:linear-gradient(135deg,#a78bfa,#4fc3f7)}
.tog input::before{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:#fff;top:3px;left:3px;transition:all 0.3s;box-shadow:0 2px 4px rgba(0,0,0,0.3)}
.tog input:checked::before{left:27px}
.tog label{font-size:0.9rem;color:var(--text);cursor:pointer;font-weight:700}
.tax-card{background:rgba(74,222,128,0.05);border:1.5px solid rgba(74,222,128,0.3);border-radius:10px;padding:12px;margin-bottom:10px;transition:all 0.2s}
.tax-card:hover{border-color:var(--ok);background:rgba(74,222,128,0.08)}
.tax-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.tax-title{font-size:0.85rem;font-weight:700;color:var(--ok);display:flex;align-items:center;gap:6px}
.tax-badge{background:var(--ok);color:#001830;font-size:0.65rem;padding:3px 8px;border-radius:6px;font-weight:800;text-transform:uppercase}
.tax-detail{font-size:0.75rem;color:var(--muted);margin:3px 0;line-height:1.4}
.tax-amount{font-size:1.05rem;font-weight:800;color:var(--ok);margin-top:8px;padding-top:8px;border-top:1px solid rgba(74,222,128,0.2)}
.tax-saved{font-size:0.7rem;color:var(--muted);margin-top:2px}
.tax-saved strong{color:var(--ok)}
.tax-summary{background:linear-gradient(135deg,rgba(255,215,0,0.15),rgba(255,165,0,0.15));border:2px solid #fbbf24;border-radius:12px;padding:18px;margin-top:14px;text-align:center;box-shadow:0 4px 16px rgba(251,191,36,0.2)}
.tax-summary .sum-label{font-size:0.75rem;color:#d97706;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.8px;font-weight:700}
.tax-summary .sum-value{font-size:2.2rem;font-weight:900;color:#fbbf24;margin-bottom:6px;text-shadow:0 2px 4px rgba(0,0,0,0.2)}
.tax-summary .sum-desc{font-size:0.8rem;color:var(--muted);font-weight:500}
.tax-breakdown{background:rgba(139,158,184,0.05);border-radius:8px;padding:10px;margin-top:10px;font-size:0.75rem}
.tax-breakdown-item{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid rgba(139,158,184,0.1)}
.tax-breakdown-item:last-child{border-bottom:none}
.tax-breakdown-label{color:var(--muted)}
.tax-breakdown-value{color:var(--text);font-weight:700}

/* Mobile styles */
body.mobile-mode{font-size:16px}
body.mobile-mode header{padding:12px 16px;flex-wrap:wrap}
body.mobile-mode .logo{font-size:2.4rem}
body.mobile-mode h1{font-size:1rem}
body.mobile-mode .actions{width:100%;margin-top:10px;flex-wrap:wrap}
body.mobile-mode .actions button{flex:1;min-width:calc(50% - 4px);font-size:0.85rem}
body.mobile-mode .main{display:flex;flex-direction:column;padding:12px;gap:14px}
body.mobile-mode .col{max-height:none;overflow-y:visible}
body.mobile-mode .card{padding:16px}
body.mobile-mode h3{font-size:1.05rem}
body.mobile-mode .input-group{margin-bottom:18px}
body.mobile-mode .input-head{font-size:0.95rem;margin-bottom:12px}
body.mobile-mode .val{font-size:1.05rem}
body.mobile-mode input[type=range]{height:40px;margin:10px 0;padding:8px 0}
body.mobile-mode input[type=range]::-webkit-slider-thumb{width:28px;height:28px}
body.mobile-mode input[type=range]::-moz-range-thumb{width:28px;height:28px}
body.mobile-mode .kpi{padding:16px;margin-bottom:14px}
body.mobile-mode .kpi .label{font-size:0.85rem;margin-bottom:8px}
body.mobile-mode .kpi .big{font-size:1.6rem}
body.mobile-mode .kpi .small{font-size:0.85rem}
body.mobile-mode .cities{grid-template-columns:1fr 1fr;gap:12px}
body.mobile-mode .city-chip{padding:14px;min-height:90px}
body.mobile-mode .city-name{font-size:1rem}
body.mobile-mode .city-info{font-size:0.85rem}
body.mobile-mode table{font-size:0.9rem}
body.mobile-mode th,body.mobile-mode td{padding:12px 10px}
body.mobile-mode .tog{padding:16px;margin-bottom:16px}
body.mobile-mode .tog input{width:58px;height:30px}
body.mobile-mode .tog input::before{width:24px;height:24px}
body.mobile-mode .tog input:checked::before{left:31px}
body.mobile-mode .tog label{font-size:1rem}
body.mobile-mode button{padding:12px 20px;font-size:0.95rem;min-height:48px}
body.mobile-mode .ghost{padding:10px 16px}
body.mobile-mode .tax-card{padding:14px}
body.mobile-mode .tax-title{font-size:0.95rem}
body.mobile-mode .tax-amount{font-size:1.25rem}
body.mobile-mode .tax-summary .sum-value{font-size:2.6rem}
</style>
</head>
<body>
<header>
<div class="logo">üå≥</div>
<div><h1>Root Planner 2026 PRO</h1></div>
<div class="actions">
<div class="lang-dropdown">
<button class="lang-btn ghost" onclick="toggleLang()">
<span class="flag" id="currentFlag">üáßüá¨</span>
<span id="currentLang">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</span>
</button>
<div class="lang-menu" id="langMenu">
<div class="lang-option active" onclick="setLang(0)"><span class="flag">üáßüá¨</span><span>–ë—ä–ª–≥–∞—Ä—Å–∫–∏</span></div>
<div class="lang-option" onclick="setLang(1)"><span class="flag">üá¨üáß</span><span>English</span></div>
<div class="lang-option" onclick="setLang(2)"><span class="flag">üá©üá™</span><span>Deutsch</span></div>
<div class="lang-option" onclick="setLang(3)"><span class="flag">üá™üá∏</span><span>Espa√±ol</span></div>
<div class="lang-option" onclick="setLang(4)"><span class="flag">üá´üá∑</span><span>Fran√ßais</span></div>
</div>
</div>
<button class="ghost" onclick="toggleMobile()" id="mobBtn">
<span class="uber">üíª Desktop</span>
<span class="gen">üì± –ú–æ–±–∏–ª–µ–Ω</span>
</button>
<button onclick="location.reload()" data-t="reset">üîÑ –ü—Ä–µ–∑–∞—Ä–µ–¥–∏</button>
</div>
</header>

<div class="main">
<!-- LEFT COLUMN -->
<div class="col">
<!-- Mode Toggle - FIRST! -->
<div class="card">
<div class="tog" onclick="toggleMode()">
<input type="checkbox" id="togMode">
<label for="togMode">
<span class="uber" data-t="mode_uber">üöó Uber —Ä–µ–∂–∏–º</span>
<span class="gen" data-t="mode_gen">üíº –û–±—â —Ä–µ–∂–∏–º</span>
</label>
</div>
</div>

<!-- Household -->
<div class="card">
<h3 data-t="hh">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –î–æ–º–∞–∫–∏–Ω—Å—Ç–≤–æ</h3>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="adults">–í—ä–∑—Ä–∞—Å—Ç–Ω–∏</span>
<span class="val" id="vAdults">2</span>
</div>
<input type="range" id="sAdults" min="1" max="4" value="2" oninput="S.a=+this.value;calc()">
</div>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="kids">–î–µ—Ü–∞</span>
<span class="val" id="vKids">3</span>
</div>
<input type="range" id="sKids" min="0" max="6" value="3" oninput="S.k=+this.value;calc()">
</div>
</div>

<!-- Insurance -->
<div class="card uber">
<h3 data-t="health">üè• –ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ</h3>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="hlth_ins_ad">–ó–∞ –≤—ä–∑—Ä–∞—Å—Ç–µ–Ω (‚Ç¨/–º–µ—Å)</span>
<span class="val neg" id="vHealthA">-400</span>
</div>
<input type="range" id="sHealthA" min="0" max="800" value="400" step="10" oninput="S.ha=+this.value;calc()">
</div>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="hlth_ins_kid">–ó–∞ –¥–µ—Ç–µ (‚Ç¨/–º–µ—Å)</span>
<span class="val neg" id="vHealthK">-200</span>
</div>
<input type="range" id="sHealthK" min="0" max="400" value="200" step="10" oninput="S.hk=+this.value;calc()">
</div>
</div>

<!-- Budget -->
<div class="card">
<h3 data-t="rent">üè† –ú–µ—Å–µ—á–µ–Ω –Ω–∞–µ–º</h3>
<div class="input-group active">
<div class="input-head">
<span class="input-label" data-t="rent_budget">–ë—é–¥–∂–µ—Ç –∑–∞ –Ω–∞–µ–º</span>
<span class="val neg" id="vRent">-2000</span>
</div>
<input type="range" id="sRent" min="500" max="6000" value="2000" step="50" oninput="S.r=+this.value;calc()">
</div>
</div>

<!-- Tips/Additional -->
<div class="card">
<h3 data-t="tips">üí∂ –ë–∞–∫—à–∏—à / –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏</h3>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="add_income">–ù–∞ –º–µ—Å–µ—Ü</span>
<span class="val" id="vExtra">0</span>
</div>
<input type="range" id="sExtra" min="0" max="2000" value="0" step="50" oninput="S.e=+this.value;calc()">
</div>
</div>

<!-- General Mode Salary -->
<div class="card gen">
<h3 data-t="emp">üíº –ó–∞–ø–ª–∞—Ç–∞</h3>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="sal">–ë—Ä—É—Ç–Ω–∞ –∑–∞–ø–ª–∞—Ç–∞ (‚Ç¨/–º–µ—Å)</span>
<span class="val" id="vSalary">5000</span>
</div>
<input type="range" id="sSalary" min="1000" max="12000" value="5000" step="100" oninput="S.s=+this.value;calc()">
</div>
</div>

<!-- Uber Parameters -->
<div class="card uber">
<h3 data-t="uber_par">üöó Uber –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</h3>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="comfort">‚òÄÔ∏è Uber Comfort –∫—É—Ä—Å–æ–≤–µ (%)</span>
<span class="val" id="vComfort">45</span>
</div>
<input type="range" id="sComfort" min="0" max="100" value="45" step="5" oninput="S.cf=+this.value;calc()">
</div>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="work_days">–†–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏</span>
<span class="val" id="vDays">22</span>
</div>
<input type="range" id="sDays" min="10" max="30" value="22" oninput="S.w=+this.value;calc()">
</div>
<div class="input-group active">
<div class="input-head">
<span class="input-label" data-t="km_day">–ö–∏–ª–æ–º–µ—Ç—Ä–∏ –Ω–∞ –¥–µ–Ω</span>
<span class="val" id="vKmDay">220</span>
</div>
<input type="range" id="sKmDay" min="50" max="400" value="220" step="10" oninput="S.l=+this.value;calc()">
</div>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="meals">–•—Ä–∞–Ω–∞ –Ω–∞ –¥–µ–Ω (‚Ç¨)</span>
<span class="val neg" id="vMeals">-8</span>
</div>
<input type="range" id="sMeals" min="0" max="30" value="8" oninput="S.em=+this.value;calc()">
</div>
<div class="input-group">
<div class="input-head">
<span class="input-label" data-t="pension">–ü–µ–Ω—Å–∏—è (%)</span>
<span class="val neg" id="vPension">-5</span>
</div>
<input type="range" id="sPension" min="0" max="15" value="5" oninput="S.p=+this.value;calc()">
</div>
</div>
</div>

<!-- MIDDLE COLUMN -->
<div class="col">
<!-- Cities Grid -->
<div class="card">
<h3 data-t="cities">üåç –í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</h3>
<div class="cities" id="cityGrid"></div>
</div>

<!-- Rankings Table -->
<div class="card">
<h3 data-t="rank">üìä –ö–ª–∞—Å–∞—Ü–∏—è</h3>
<div style="max-height:600px;overflow-y:auto">
<table>
<thead>
<tr>
<th data-t="th_city">–ì—Ä–∞–¥</th>
<th data-t="th_score">–†–µ–∑—É–ª—Ç–∞—Ç</th>
<th class="uber" data-t="th_savings">–°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è</th>
<th class="gen" data-t="th_net">–ù–µ—Ç–µ–Ω –¥–æ—Ö–æ–¥</th>
</tr>
</thead>
<tbody id="rankTable"></tbody>
</table>
</div>
</div>
</div>

<!-- RIGHT COLUMN -->
<div class="col">
<!-- Selected City KPIs -->
<div class="card">
<h3 id="selCityName" data-t="sel_city">üéØ –ò–∑–±–µ—Ä–∏ –≥—Ä–∞–¥</h3>
<div id="kpiContainer"></div>
</div>

<!-- Tax Optimizations (Uber mode only) -->
<div class="card uber">
<h3 data-t="tax_opt">üí∞ –î–∞–Ω—ä—á–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏</h3>
<div id="taxOptContainer"></div>
<div class="tax-summary">
<div class="sum-label" data-t="tax_saved_yr">üíµ –°–ø–µ—Å—Ç–µ–Ω–∏ –¥–∞–Ω—ä—Ü–∏ –≥–æ–¥–∏—à–Ω–æ</div>
<div class="sum-value" id="taxSavedTotal">0 ‚Ç¨</div>
<div class="sum-desc" id="taxSavedMonth">0 ‚Ç¨ –Ω–∞ –º–µ—Å–µ—Ü</div>
</div>
</div>
</div>
</div>

<script>
const T={
bg:{mob:'üíª Desktop',reset:'üîÑ –ü—Ä–µ–∑–∞—Ä–µ–¥–∏',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –î–æ–º–∞–∫–∏–Ω—Å—Ç–≤–æ',adults:'–í—ä–∑—Ä–∞—Å—Ç–Ω–∏',kids:'–î–µ—Ü–∞',
health:'üè• –ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ',hlth_ins_ad:'–ó–∞ –≤—ä–∑—Ä–∞—Å—Ç–µ–Ω (‚Ç¨/–º–µ—Å)',hlth_ins_kid:'–ó–∞ –¥–µ—Ç–µ (‚Ç¨/–º–µ—Å)',
rent:'üè† –ú–µ—Å–µ—á–µ–Ω –Ω–∞–µ–º',rent_budget:'–ë—é–¥–∂–µ—Ç –∑–∞ –Ω–∞–µ–º',tips:'üí∂ –ë–∞–∫—à–∏—à / –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏',add_income:'–ù–∞ –º–µ—Å–µ—Ü',
emp:'üíº –ó–∞–ø–ª–∞—Ç–∞',sal:'–ë—Ä—É—Ç–Ω–∞ –∑–∞–ø–ª–∞—Ç–∞ (‚Ç¨/–º–µ—Å)',uber_par:'üöó Uber –ø–∞—Ä–∞–º–µ—Ç—Ä–∏',comfort:'‚òÄÔ∏è Uber Comfort –∫—É—Ä—Å–æ–≤–µ (%)',
work_days:'–†–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏',km_day:'–ö–∏–ª–æ–º–µ—Ç—Ä–∏ –Ω–∞ –¥–µ–Ω',meals:'–•—Ä–∞–Ω–∞ –Ω–∞ –¥–µ–Ω (‚Ç¨)',
pension:'–ü–µ–Ω—Å–∏—è (%)',mode_uber:'üöó Uber —Ä–µ–∂–∏–º',mode_gen:'üíº –û–±—â —Ä–µ–∂–∏–º',cities:'üåç –í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ',rank:'üìä –ö–ª–∞—Å–∞—Ü–∏—è',
th_city:'–ì—Ä–∞–¥',th_score:'–†–µ–∑—É–ª—Ç–∞—Ç',th_savings:'–°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è',th_net:'–ù–µ—Ç–µ–Ω –¥–æ—Ö–æ–¥',sel_city:'üéØ –ò–∑–±–µ—Ä–∏ –≥—Ä–∞–¥',
tax_opt:'üí∞ –î–∞–Ω—ä—á–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏',tax_saved_yr:'üíµ –°–ø–µ—Å—Ç–µ–Ω–∏ –¥–∞–Ω—ä—Ü–∏ –≥–æ–¥–∏—à–Ω–æ',
km_ded:'üìç –ö–∏–ª–æ–º–µ—Ç—Ä–∞–∂',km_auto:'–ê–í–¢–û',km_calc:'–∫–º √ó –¥–Ω–∏ √ó 12 –º–µ—Å',
km_total:'–ø—Ä–∏—Å–ø–∞–¥–∞–Ω–µ',km_saved:'–°–ø–µ—Å—Ç–µ–Ω–∏',child_ded:'üë∂ –î–µ—Ç—Å–∫–∏ –ø—Ä–∏—Å–ø–∞–¥–∞–Ω–∏—è',child_auto:'–ê–í–¢–û',
child_per:'–¥–µ—Ü–∞ √ó',child_total:'–ø—Ä–∏—Å–ø–∞–¥–∞–Ω–µ',child_saved:'–°–ø–µ—Å—Ç–µ–Ω–∏',
child_ben:'üíù –î–µ—Ç—Å–∫–∏ –Ω–∞–¥–±–∞–≤–∫–∏',child_ben_mo:'–Ω–∞ –º–µ—Å–µ—Ü',child_ben_yr:'–≥–æ–¥–∏—à–Ω–æ',
kpi_gross:'üìä –ë—Ä—É—Ç–µ–Ω –¥–æ—Ö–æ–¥',kpi_net:'üí∞ –ù–µ—Ç–µ–Ω –¥–æ—Ö–æ–¥',kpi_savings:'üíµ –°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è',
kpi_rent:'üè† –ù–∞–µ–º',kpi_qol:'‚≠ê –ö–∞—á–µ—Å—Ç–≤–æ –Ω–∞ –∂–∏–≤–æ—Ç',
km_needed:'üéØ –ù—É–∂–Ω–∏ –∫–º/–¥–µ–Ω',profit_at:'üí∞ –ü–µ—á–∞–ª–±–∞ –ø—Ä–∏'},
en:{mob:'üíª Desktop',reset:'üîÑ Reload',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Household',adults:'Adults',kids:'Children',
health:'üè• Health Insurance',hlth_ins_ad:'Per Adult (‚Ç¨/mo)',hlth_ins_kid:'Per Child (‚Ç¨/mo)',
rent:'üè† Monthly Rent',rent_budget:'Rent Budget',tips:'üí∂ Tips / Additional',add_income:'Per month',
emp:'üíº Salary',sal:'Gross Salary (‚Ç¨/mo)',uber_par:'üöó Uber Parameters',comfort:'‚òÄÔ∏è Uber Comfort rides (%)',
work_days:'Working days',km_day:'Kilometers per day',meals:'Meals per day (‚Ç¨)',
pension:'Pension (%)',mode_uber:'üöó Uber Mode',mode_gen:'üíº General Mode',cities:'üåç All Cities',rank:'üìä Rankings',
th_city:'City',th_score:'Score',th_savings:'Savings',th_net:'Net Income',sel_city:'üéØ Select City',
tax_opt:'üí∞ Tax Optimizations',tax_saved_yr:'üíµ Tax saved yearly',
km_ded:'üìç Mileage',km_auto:'AUTO',km_calc:'km √ó days √ó 12 mo',
km_total:'deduction',km_saved:'Saved',child_ded:'üë∂ Child Deductions',child_auto:'AUTO',
child_per:'children √ó',child_total:'deduction',child_saved:'Saved',
child_ben:'üíù Child Benefits',child_ben_mo:'per month',child_ben_yr:'per year',
kpi_gross:'üìä Gross Income',kpi_net:'üí∞ Net Income',kpi_savings:'üíµ Savings',
kpi_rent:'üè† Rent',kpi_qol:'‚≠ê Quality of Life',
km_needed:'üéØ Needed km/day',profit_at:'üí∞ Profit at'},
de:{mob:'üíª Desktop',reset:'üîÑ Neu laden',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Haushalt',adults:'Erwachsene',kids:'Kinder',
health:'üè• Krankenversicherung',hlth_ins_ad:'Pro Erwachsener (‚Ç¨/Mo)',hlth_ins_kid:'Pro Kind (‚Ç¨/Mo)',
rent:'üè† Monatsmiete',rent_budget:'Mietbudget',tips:'üí∂ Trinkgeld / Zus√§tzlich',add_income:'Pro Monat',
emp:'üíº Gehalt',sal:'Bruttogehalt (‚Ç¨/Mo)',uber_par:'üöó Uber Parameter',comfort:'‚òÄÔ∏è Uber Comfort Fahrten (%)',
work_days:'Arbeitstage',km_day:'Kilometer pro Tag',meals:'Essen pro Tag (‚Ç¨)',
pension:'Rente (%)',mode_uber:'üöó Uber Modus',mode_gen:'üíº Allgemein',cities:'üåç Alle St√§dte',rank:'üìä Rangliste',
th_city:'Stadt',th_score:'Punktzahl',th_savings:'Ersparnisse',th_net:'Nettoeinkommen',sel_city:'üéØ Stadt w√§hlen',
tax_opt:'üí∞ Steueroptimierungen',tax_saved_yr:'üíµ J√§hrlich gesparte Steuern',
km_ded:'üìç Kilometerpauschale',km_auto:'AUTO',km_calc:'km √ó Tage √ó 12 Mo',
km_total:'Abzug',km_saved:'Gespart',child_ded:'üë∂ Kinderabz√ºge',child_auto:'AUTO',
child_per:'Kinder √ó',child_total:'Abzug',child_saved:'Gespart',
child_ben:'üíù Kindergeld',child_ben_mo:'pro Monat',child_ben_yr:'pro Jahr',
kpi_gross:'üìä Bruttoeinkommen',kpi_net:'üí∞ Nettoeinkommen',kpi_savings:'üíµ Ersparnisse',
kpi_rent:'üè† Miete',kpi_qol:'‚≠ê Lebensqualit√§t',
km_needed:'üéØ Ben√∂tigt km/Tag',profit_at:'üí∞ Gewinn bei'},
es:{mob:'üíª Escritorio',reset:'üîÑ Recargar',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Hogar',adults:'Adultos',kids:'Ni√±os',
health:'üè• Seguro M√©dico',hlth_ins_ad:'Por Adulto (‚Ç¨/mes)',hlth_ins_kid:'Por Ni√±o (‚Ç¨/mes)',
rent:'üè† Alquiler Mensual',rent_budget:'Presupuesto',tips:'üí∂ Propinas / Adicional',add_income:'Por mes',
emp:'üíº Salario',sal:'Salario Bruto (‚Ç¨/mes)',uber_par:'üöó Par√°metros Uber',comfort:'‚òÄÔ∏è Viajes Uber Comfort (%)',
work_days:'D√≠as laborables',km_day:'Kil√≥metros por d√≠a',meals:'Comida por d√≠a (‚Ç¨)',
pension:'Pensi√≥n (%)',mode_uber:'üöó Modo Uber',mode_gen:'üíº Modo General',cities:'üåç Todas las Ciudades',rank:'üìä Clasificaci√≥n',
th_city:'Ciudad',th_score:'Puntuaci√≥n',th_savings:'Ahorros',th_net:'Ingreso Neto',sel_city:'üéØ Seleccionar Ciudad',
tax_opt:'üí∞ Optimizaciones Fiscales',tax_saved_yr:'üíµ Impuestos ahorrados',
km_ded:'üìç Kilometraje',km_auto:'AUTO',km_calc:'km √ó d√≠as √ó 12',
km_total:'deducci√≥n',km_saved:'Ahorrado',child_ded:'üë∂ Deducciones por Hijos',child_auto:'AUTO',
child_per:'ni√±os √ó',child_total:'deducci√≥n',child_saved:'Ahorrado',
child_ben:'üíù Prestaciones por Hijos',child_ben_mo:'por mes',child_ben_yr:'por a√±o',
kpi_gross:'üìä Ingreso Bruto',kpi_net:'üí∞ Ingreso Neto',kpi_savings:'üíµ Ahorros',
kpi_rent:'üè† Alquiler',kpi_qol:'‚≠ê Calidad de Vida',
km_needed:'üéØ km/d√≠a necesarios',profit_at:'üí∞ Ganancia con'},
fr:{mob:'üíª Bureau',reset:'üîÑ Recharger',hh:'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ M√©nage',adults:'Adultes',kids:'Enfants',
health:'üè• Assurance Maladie',hlth_ins_ad:'Par Adulte (‚Ç¨/mois)',hlth_ins_kid:'Par Enfant (‚Ç¨/mois)',
rent:'üè† Loyer Mensuel',rent_budget:'Budget loyer',tips:'üí∂ Pourboires / Suppl√©ment',add_income:'Par mois',
emp:'üíº Salaire',sal:'Salaire Brut (‚Ç¨/mois)',uber_par:'üöó Param√®tres Uber',comfort:'‚òÄÔ∏è Courses Uber Comfort (%)',
work_days:'Jours travaill√©s',km_day:'Kilom√®tres par jour',meals:'Repas par jour (‚Ç¨)',
pension:'Pension (%)',mode_uber:'üöó Mode Uber',mode_gen:'üíº Mode G√©n√©ral',cities:'üåç Toutes les Villes',rank:'üìä Classement',
th_city:'Ville',th_score:'Score',th_savings:'√âconomies',th_net:'Revenu Net',sel_city:'üéØ S√©lectionner',
tax_opt:'üí∞ Optimisations Fiscales',tax_saved_yr:'üíµ Imp√¥ts √©conomis√©s',
km_ded:'üìç Kilom√©trage',km_auto:'AUTO',km_calc:'km √ó jours √ó 12',
km_total:'d√©duction',km_saved:'√âconomis√©',child_ded:'üë∂ D√©ductions Enfants',child_auto:'AUTO',
child_per:'enfants √ó',child_total:'d√©duction',child_saved:'√âconomis√©',
child_ben:'üíù Allocations Familiales',child_ben_mo:'par mois',child_ben_yr:'par an',
kpi_gross:'üìä Revenu Brut',kpi_net:'üí∞ Revenu Net',kpi_savings:'üíµ √âconomies',
kpi_rent:'üè† Loyer',kpi_qol:'‚≠ê Qualit√© de Vie',
km_needed:'üéØ km/jour n√©cessaires',profit_at:'üí∞ B√©n√©fice √†'}
};

const S={a:2,k:3,r:2000,ha:400,hk:200,e:0,s:5000,w:22,l:220,em:8,p:5,cf:45,m:true,sel:null,lg:0,mob:false};

const D={
Zurich:{n:'Z√ºrich',c:'ch',rm:2500,rx:6000,ar:4000,hh:600,sc:5,bf:6,pk:1.2,tr:20,ek:3,cb:215,cd:9000},
Zug:{n:'Zug',c:'ch',rm:2600,rx:6500,ar:4200,hh:620,sc:5,bf:6,pk:1.2,tr:18,ek:2,cb:215,cd:9000},
Geneva:{n:'Geneva',c:'ch',rm:2400,rx:5500,ar:3800,hh:600,sc:4,bf:6,pk:1.1,tr:22,ek:4,cb:311,cd:11000},
Oslo:{n:'Oslo',c:'no',rm:1900,rx:3600,ar:2600,hh:520,sc:5,bf:5,pk:1.0,tr:32,ek:7,cb:150,cd:7000},
Berlin:{n:'Berlin',c:'de',rm:1500,rx:3200,ar:2200,hh:450,sc:4,bf:3.9,pk:0.75,tr:25,ek:9,cb:255,cd:9000},
Munich:{n:'M√ºnchen',c:'de',rm:2000,rx:4500,ar:3000,hh:500,sc:5,bf:4.5,pk:0.9,tr:27,ek:7,cb:255,cd:9000},
Vienna:{n:'Wien',c:'at',rm:1600,rx:3000,ar:2200,hh:480,sc:4,bf:4,pk:0.7,tr:28,ek:8,cb:148,cd:6500},
Amsterdam:{n:'Amsterdam',c:'nl',rm:2200,rx:4000,ar:2800,hh:500,sc:4,bf:4.2,pk:0.75,tr:30,ek:8,cb:130,cd:6000},
Paris:{n:'Paris',c:'fr',rm:1800,rx:3800,ar:2500,hh:480,sc:4,bf:4,pk:0.7,tr:30,ek:9,cb:142,cd:7500},
London:{n:'London',c:'gb',rm:2400,rx:5000,ar:3200,hh:520,sc:4,bf:4.5,pk:0.7,tr:32,ek:10,cb:102,cd:5500},
Brussels:{n:'Brussels',c:'be',rm:1400,rx:2800,ar:2000,hh:440,sc:3,bf:3.5,pk:0.65,tr:28,ek:9,cb:180,cd:7000},
Barcelona:{n:'Barcelona',c:'es',rm:1400,rx:2600,ar:1800,hh:400,sc:4,bf:3.5,pk:0.55,tr:24,ek:10,cb:58,cd:3500},
Madrid:{n:'Madrid',c:'es',rm:1300,rx:2400,ar:1700,hh:380,sc:4,bf:3.3,pk:0.5,tr:24,ek:10,cb:58,cd:3500},
Lisbon:{n:'Lisboa',c:'pt',rm:1200,rx:2200,ar:1600,hh:360,sc:4,bf:3.2,pk:0.45,tr:22,ek:11,cb:63,cd:3200},
Rome:{n:'Roma',c:'it',rm:1400,rx:2600,ar:1800,hh:380,sc:3,bf:3.3,pk:0.55,tr:26,ek:10,cb:50,cd:3000},
Prague:{n:'Praha',c:'cz',rm:1200,rx:2000,ar:1400,hh:320,sc:3,bf:3,pk:0.35,tr:20,ek:12,cb:30,cd:2500},
Warsaw:{n:'Warszawa',c:'pl',rm:1000,rx:1800,ar:1200,hh:300,sc:3,bf:2.8,pk:0.35,tr:18,ek:12,cb:30,cd:2000},
Budapest:{n:'Budapest',c:'hu',rm:900,rx:1600,ar:1100,hh:280,sc:3,bf:2.5,pk:0.3,tr:16,ek:13,cb:25,cd:1800},
Sofia:{n:'–°–æ—Ñ–∏—è',c:'bg',rm:700,rx:1200,ar:800,hh:200,sc:2,bf:2,pk:0.28,tr:10,ek:15,cb:20,cd:1500}
};

const CF={'ch':'üá®üá≠','no':'üá≥üá¥','de':'üá©üá™','at':'üá¶üáπ','nl':'üá≥üá±','fr':'üá´üá∑','gb':'üá¨üáß','be':'üáßüá™','es':'üá™üá∏','pt':'üáµüáπ','it':'üáÆüáπ','cz':'üá®üáø','pl':'üáµüá±','hu':'üá≠üá∫','bg':'üáßüá¨'};

function toggleLang(){document.getElementById('langMenu').classList.toggle('show')}

function setLang(i){
S.lg=i;
const langs=['üáßüá¨','üá¨üáß','üá©üá™','üá™üá∏','üá´üá∑'];
const names=['–ë—ä–ª–≥–∞—Ä—Å–∫–∏','English','Deutsch','Espa√±ol','Fran√ßais'];
document.getElementById('currentFlag').textContent=langs[i];
document.getElementById('currentLang').textContent=names[i];
document.querySelectorAll('.lang-option').forEach((el,idx)=>{
el.classList.toggle('active',idx===i);
});
document.getElementById('langMenu').classList.remove('show');
updateLang();
calc();
}

function toggleMode(){
S.m=!S.m;
document.getElementById('togMode').checked=!S.m;
document.body.classList.toggle('gm');
calc();
}

function toggleMobile(){
S.mob=!S.mob;
if(S.mob){
document.body.classList.add('mobile-mode');
}else{
document.body.classList.remove('mobile-mode');
}
calc();
}

function updateLang(){
const lang=['bg','en','de','es','fr'][S.lg];
const trans=T[lang];
document.querySelectorAll('[data-t]').forEach(el=>{
const key=el.dataset.t;
if(trans[key]){
if(el.tagName==='LABEL'||el.tagName==='SPAN'||el.tagName==='BUTTON'){
const oldText=el.textContent;
el.textContent=trans[key];
}else{
el.childNodes.forEach(node=>{
if(node.nodeType===3)node.textContent=trans[key];
});
}
}
});
}

function calc(){
const c=D;
const results=[];
const lang=['bg','en','de','es','fr'][S.lg];
const trans=T[lang];

// Update input displays
document.getElementById('vAdults').textContent=S.a;
document.getElementById('vKids').textContent=S.k;
document.getElementById('vRent').textContent='-'+S.r;
document.getElementById('vExtra').textContent=S.e;
document.getElementById('vHealthA').textContent='-'+S.ha;
document.getElementById('vHealthK').textContent='-'+S.hk;
document.getElementById('vSalary').textContent=S.s;
document.getElementById('vComfort').textContent=S.cf+' %';
document.getElementById('vDays').textContent=S.w;
document.getElementById('vKmDay').textContent=S.l;
document.getElementById('vMeals').textContent='-'+S.em;
document.getElementById('vPension').textContent='-'+S.p+' %';

Object.keys(c).forEach(key=>{
const ct=c[key];
let score,savings,netIncome,kmNeeded;

if(S.m){
// Uber mode calculations
const baseKm=S.l;
const totalKm=baseKm*S.w*12;
const emptyPct=ct.ek+(S.r<ct.rm?10:S.r>ct.rx?-5:((S.r-ct.rm)/(ct.rx-ct.rm))*(-15)+10);
const effKm=totalKm*(1-emptyPct/100);
const comfortKm=effKm*(S.cf/100);
const normalKm=effKm-comfortKm;
const comfortRate=ct.pk*1.3;
const yearGross=(normalKm*ct.pk+comfortKm*comfortRate)+S.e*12;
const childBen=ct.cb*S.k*12;
const totalGross=yearGross+childBen;

// Tax deductions
const kmDeduction=totalKm*0.70;
const childDeduction=ct.cd*S.k;
const totalDeductions=kmDeduction+childDeduction;
const taxableIncome=Math.max(0,yearGross-totalDeductions);
const tax=taxableIncome*(ct.tr/100);

const yearExpenses=(S.r+(S.ha*S.a+S.hk*S.k)+S.em*S.w)*12;
const pension=yearGross*(S.p/100);
netIncome=totalGross-tax-yearExpenses-pension;
savings=netIncome-S.r*12;

// Calculate km needed for break-even
const targetSavings=0;
const targetNet=S.r*12+yearExpenses+pension+targetSavings+childBen;
const targetTaxable=targetNet/(1-(ct.tr/100));
const targetGross=targetTaxable+kmDeduction+childDeduction;
const avgRate=(ct.pk*(1-S.cf/100)+ct.pk*1.3*(S.cf/100));
const targetEffKm=targetGross/avgRate;
const targetTotalKm=targetEffKm/(1-emptyPct/100);
kmNeeded=Math.ceil(targetTotalKm/(S.w*12));

const qolPts=ct.sc*10+ct.bf*5+ct.hh/10;
const rentFit=S.r>=ct.rm&&S.r<=ct.rx?20:S.r<ct.rm?10:5;
const kmOverLimit=baseKm>(ct.pk*280)?-20:0;
score=Math.round(savings/100+qolPts+rentFit+kmOverLimit+(childBen/1000));
}else{
// General mode
const yearGross=S.s*12;
const childBen=ct.cb*S.k*12;
const totalGross=yearGross+childBen;
const tax=yearGross*(ct.tr/100);
const yearExpenses=(S.r+(S.ha*S.a+S.hk*S.k))*12;
netIncome=totalGross-tax-yearExpenses;
savings=netIncome-S.r*12;
kmNeeded=0;

const qolPts=ct.sc*10+ct.bf*5+ct.hh/10;
const rentFit=S.r>=ct.rm&&S.r<=ct.rx?20:S.r<ct.rm?10:5;
score=Math.round(netIncome/100+qolPts+rentFit+(childBen/1000));
}

results.push({key,score,savings:Math.round(savings),net:Math.round(netIncome/12),city:ct,kmNeeded});
});

results.sort((a,b)=>b.score-a.score);

// Update city grid
const grid=document.getElementById('cityGrid');
grid.innerHTML='';
results.forEach((r,i)=>{
const chip=document.createElement('div');
chip.className='city-chip';
if(r.key===S.sel)chip.classList.add('active');
const budgetOk=S.r>=r.city.rm&&S.r<=r.city.rx;
const kmOk=!S.m||S.l<=r.city.pk*280;
if(budgetOk&&kmOk&&r.savings>=0)chip.classList.add('ok');
else if(!budgetOk||!kmOk||r.savings<0)chip.classList.add('bad');
else chip.classList.add('warn');

let kmInfo='';
if(S.m){
kmInfo=`<div class="city-km">${trans.km_needed}: ${r.kmNeeded} –∫–º | ${trans.profit_at} ${S.l}–∫–º: ${r.savings>=0?'+':''}${r.savings.toLocaleString()}‚Ç¨</div>`;
}

chip.innerHTML=`
<div class="city-name">${CF[r.city.c]} ${r.city.n}</div>
<div class="city-info">${trans.th_score}: ${r.score}</div>
${kmInfo}
`;
chip.onclick=()=>{S.sel=r.key;calc()};
grid.appendChild(chip);
});

// Update rankings table
const tbody=document.getElementById('rankTable');
tbody.innerHTML='';
results.forEach((r,i)=>{
const tr=document.createElement('tr');
if(r.key===S.sel)tr.classList.add('sel');
if(i<3)tr.classList.add('top');
tr.innerHTML=`
<td>${CF[r.city.c]} ${r.city.n}</td>
<td><strong>${r.score}</strong></td>
<td class="uber">${r.savings>=0?'+':''}<strong>${r.savings.toLocaleString()}</strong> ‚Ç¨</td>
<td class="gen"><strong>${r.net.toLocaleString()}</strong> ‚Ç¨</td>
`;
tr.onclick=()=>{S.sel=r.key;calc()};
tbody.appendChild(tr);
});

// Update selected city details
if(S.sel){
const sel=results.find(r=>r.key===S.sel);
if(sel){
document.getElementById('selCityName').innerHTML=`üéØ ${CF[sel.city.c]} ${sel.city.n}`;
updateKPIs(sel,trans);
if(S.m)updateTaxOpt(sel,trans);
}
}else{
document.getElementById('selCityName').innerHTML=`üéØ ${trans.sel_city}`;
document.getElementById('kpiContainer').innerHTML=`<p style="color:var(--muted);text-align:center;padding:40px 0">${trans.sel_city}</p>`;
document.getElementById('taxOptContainer').innerHTML='';
document.getElementById('taxSavedTotal').textContent='0 ‚Ç¨';
document.getElementById('taxSavedMonth').textContent='0 ‚Ç¨ '+trans.child_ben_mo;
}
}

function updateKPIs(sel,trans){
const ct=sel.city;
let html='';

if(S.m){
// Uber KPIs
const baseKm=S.l;
const totalKm=baseKm*S.w*12;
const emptyPct=ct.ek+(S.r<ct.rm?10:S.r>ct.rx?-5:((S.r-ct.rm)/(ct.rx-ct.rm))*(-15)+10);
const effKm=totalKm*(1-emptyPct/100);
const comfortKm=effKm*(S.cf/100);
const normalKm=effKm-comfortKm;
const comfortRate=ct.pk*1.3;
const yearGross=(normalKm*ct.pk+comfortKm*comfortRate)+S.e*12;
const childBen=ct.cb*S.k*12;
const totalGross=yearGross+childBen;

html+=`
<div class="kpi">
<div class="label">${trans.kpi_gross}</div>
<div class="big">${Math.round(totalGross/12).toLocaleString()} ‚Ç¨</div>
<div class="small">${Math.round(totalGross).toLocaleString()} ‚Ç¨ ${trans.child_ben_yr}</div>
</div>
<div class="kpi pos">
<div class="label">${trans.kpi_net}</div>
<div class="big">${sel.net.toLocaleString()} ‚Ç¨</div>
<div class="small">${trans.child_ben_mo}</div>
</div>
<div class="kpi ${sel.savings>=0?'pos':'neg'}">
<div class="label">${trans.kpi_savings}</div>
<div class="big">${sel.savings>=0?'+':''}${sel.savings.toLocaleString()} ‚Ç¨</div>
<div class="small">${trans.child_ben_yr}</div>
</div>
<div class="kpi">
<div class="label">${trans.km_needed}</div>
<div class="big">${sel.kmNeeded} –∫–º</div>
<div class="small">–ó–∞ —Å–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è ‚â• 0‚Ç¨</div>
</div>
`;
}else{
// General mode KPIs
const yearGrossSal=S.s*12;
const childBen=ct.cb*S.k*12;
html+=`
<div class="kpi">
<div class="label">${trans.kpi_gross}</div>
<div class="big">${Math.round((yearGrossSal+childBen)/12).toLocaleString()} ‚Ç¨</div>
<div class="small">${trans.child_ben_mo}</div>
</div>
<div class="kpi pos">
<div class="label">${trans.kpi_net}</div>
<div class="big">${sel.net.toLocaleString()} ‚Ç¨</div>
<div class="small">${trans.child_ben_mo}</div>
</div>
`;
}

// Child benefits KPI
if(S.k>0){
const childBen=ct.cb*S.k*12;
html+=`
<div class="kpi">
<div class="label">${trans.child_ben}</div>
<div class="big">${Math.round(childBen/12).toLocaleString()} ‚Ç¨</div>
<div class="small">${trans.child_ben_mo} ¬∑ ${childBen.toLocaleString()} ‚Ç¨ ${trans.child_ben_yr}</div>
</div>
`;
}

// Rent KPI
html+=`
<div class="kpi">
<div class="label">${trans.kpi_rent}</div>
<div class="big">-${S.r.toLocaleString()} ‚Ç¨</div>
<div class="small">${ct.rm}‚Ç¨ - ${ct.rx}‚Ç¨</div>
</div>
`;

// QoL KPI
const qol=ct.sc*10+ct.bf*5+ct.hh/10;
html+=`
<div class="kpi">
<div class="label">${trans.kpi_qol}</div>
<div class="big">${Math.round(qol)}</div>
<div class="small">‚≠ê ${ct.sc} ¬∑ üçΩÔ∏è ${ct.bf} ¬∑ üè• ${ct.hh}‚Ç¨</div>
</div>
`;

document.getElementById('kpiContainer').innerHTML=html;
}

function updateTaxOpt(sel,trans){
const ct=sel.city;
const totalKm=S.l*S.w*12;
const kmDeduction=totalKm*0.70;
const kmSaved=kmDeduction*(ct.tr/100);
const childDeduction=ct.cd*S.k;
const childSaved=childDeduction*(ct.tr/100);
const totalSaved=kmSaved+childSaved;

let html='';

// Kilometrage deduction
html+=`
<div class="tax-card">
<div class="tax-head">
<div class="tax-title">üìç ${trans.km_ded}</div>
<div class="tax-badge">${trans.km_auto}</div>
</div>
<div class="tax-detail">${S.l} ${trans.km_calc}</div>
<div class="tax-detail">${totalKm.toLocaleString()} –∫–º √ó 0.70‚Ç¨ = ${Math.round(kmDeduction).toLocaleString()}‚Ç¨</div>
<div class="tax-amount">${Math.round(kmDeduction).toLocaleString()}‚Ç¨ ${trans.km_total}</div>
<div class="tax-saved">${trans.km_saved}: <strong>${Math.round(kmSaved).toLocaleString()}‚Ç¨</strong></div>
</div>
`;

// Child deductions
if(S.k>0){
html+=`
<div class="tax-card">
<div class="tax-head">
<div class="tax-title">üë∂ ${trans.child_ded}</div>
<div class="tax-badge">${trans.child_auto}</div>
</div>
<div class="tax-detail">${S.k} ${trans.child_per} ${ct.cd.toLocaleString()}‚Ç¨</div>
<div class="tax-amount">${(childDeduction).toLocaleString()}‚Ç¨ ${trans.child_total}</div>
<div class="tax-saved">${trans.child_saved}: <strong>${Math.round(childSaved).toLocaleString()}‚Ç¨</strong></div>
</div>
`;
}

// Breakdown
html+=`
<div class="tax-breakdown">
<div class="tax-breakdown-item">
<span class="tax-breakdown-label">üìç ${trans.km_ded}:</span>
<span class="tax-breakdown-value">${Math.round(kmDeduction).toLocaleString()}‚Ç¨</span>
</div>
`;
if(S.k>0){
html+=`
<div class="tax-breakdown-item">
<span class="tax-breakdown-label">üë∂ ${trans.child_ded}:</span>
<span class="tax-breakdown-value">${childDeduction.toLocaleString()}‚Ç¨</span>
</div>
`;
}
html+=`
<div class="tax-breakdown-item" style="font-weight:700;border-top:2px solid var(--border);padding-top:8px;margin-top:4px">
<span class="tax-breakdown-label">üí∞ ${trans.tax_opt}:</span>
<span class="tax-breakdown-value">${Math.round(kmDeduction+childDeduction).toLocaleString()}‚Ç¨</span>
</div>
</div>
`;

document.getElementById('taxOptContainer').innerHTML=html;
document.getElementById('taxSavedTotal').textContent=Math.round(totalSaved).toLocaleString()+' ‚Ç¨';
document.getElementById('taxSavedMonth').textContent=Math.round(totalSaved/12).toLocaleString()+' ‚Ç¨ '+trans.child_ben_mo;
}

// Initialize
updateLang();
calc();
</script>
</body>
</html>
