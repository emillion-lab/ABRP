<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>A Better Root Planting</title>
<style>
:root{--bg:#0a1929;--panel:#1a2942;--border:#2d3e55;--muted:#8b9eb8;--text:#e8f0f8;--accent:#4fc3f7;--ok:#4ade80;--warn:#fbbf24;--bad:#f87171}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,sans-serif;background:#0a1929;color:var(--text);font-size:13px}
header{position:sticky;top:0;background:rgba(10,25,41,0.95);border-bottom:2px solid var(--border);padding:12px 24px;display:flex;align-items:center;gap:12px;z-index:100}
.logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,#4fc3f7,#a78bfa);display:flex;align-items:center;justify-content:center;font-size:2rem}
h1{font-size:1.2rem;font-weight:800;color:var(--accent)}
button{background:var(--accent);color:#001830;border:none;padding:10px 18px;border-radius:10px;font-weight:700;cursor:pointer;font-size:0.9rem}
.ghost{background:transparent;color:var(--muted);border:1px solid var(--border)}.ghost:hover{background:var(--panel);color:var(--text)}
.actions{margin-left:auto;display:flex;gap:8px;position:relative}
.lang-dropdown{position:relative}
.lang-btn{display:flex;align-items:center;gap:8px}
.lang-menu{display:none;position:absolute;top:100%;right:0;margin-top:8px;background:var(--panel);border:1px solid var(--border);border-radius:10px;min-width:200px;box-shadow:0 8px 24px rgba(0,0,0,0.4);z-index:200}
.lang-menu.show{display:block}
.lang-option{display:flex;align-items:center;gap:10px;padding:12px 16px;cursor:pointer;transition:all 0.2s;border-bottom:1px solid var(--border)}
.lang-option:last-child{border-bottom:none}
.lang-option:hover{background:rgba(79,195,247,0.1)}
.lang-option.active{background:rgba(79,195,247,0.15)}
.flag{width:24px;height:18px;object-fit:cover;border-radius:3px;display:inline-block}
.main{display:grid;grid-template-columns:380px 1fr 440px;gap:20px;padding:20px;max-width:2400px;margin:0 auto}
.col{display:flex;flex-direction:column;gap:16px;max-height:calc(100vh - 96px);overflow-y:auto}
.card{background:#162030;border:1px solid var(--border);border-radius:12px;padding:16px}
h3{color:var(--accent);font-size:0.9rem;margin-bottom:12px}.input-group{margin-bottom:16px;padding:4px 0}
.input-group.active{background:rgba(79,195,247,0.05);border-radius:8px;padding:8px}
.slider-wrapper{padding:12px 0;margin:8px -8px;position:relative}
.slider-wrapper input[type=range]{margin:0}
.input-head{display:flex;justify-content:space-between;margin-bottom:8px}.input-label{color:var(--muted);font-size:0.85rem}
.val{color:var(--accent);font-weight:800}.val.neg{color:var(--bad)}
input[type=range]{width:100%;height:14px;border-radius:8px;background:var(--panel);border:1px solid var(--border);margin:8px 0;cursor:pointer;touch-action:pan-y;pointer-events:auto}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:grab;border:2px solid #001830;touch-action:none}
input[type=range]::-webkit-slider-thumb:active{cursor:grabbing;transform:scale(1.1)}
input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:grab;border:2px solid #001830;touch-action:none}
.kpi{background:rgba(79,195,247,0.05);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:12px}
.kpi .label{font-size:0.72rem;color:var(--muted);margin-bottom:6px}.kpi .big{font-size:1.2rem;font-weight:900;color:var(--accent)}
.kpi .small{font-size:0.7rem;color:var(--muted);margin-top:4px}.kpi.pos .big{color:var(--ok)}.kpi.neg .big{color:var(--bad)}
.cities{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:12px}
.city-chip{background:#1a2535;border:3px solid var(--border);padding:12px;border-radius:10px;cursor:pointer;transition:all 0.2s}
.city-chip:hover{border-color:var(--accent)}.city-chip.active{border-color:var(--accent);background:rgba(79,195,247,0.1)}
.city-chip.ok{border-color:var(--ok)}.city-chip.warn{border-color:var(--warn)}.city-chip.bad{border-color:var(--bad)}
.city-name{font-weight:800;font-size:0.95rem;margin-bottom:6px;display:flex;align-items:center;gap:8px}.city-info{font-size:0.75rem;color:var(--muted);margin-top:3px}
table{width:100%;border-collapse:collapse;font-size:0.85rem}thead{background:#1a2942;position:sticky;top:0;z-index:5}
th{padding:12px 8px;text-align:left;color:var(--accent);border-bottom:2px solid var(--accent);font-size:0.72rem}
td{padding:10px 8px;border-bottom:1px solid var(--border)}tbody tr{cursor:pointer;transition:all 0.2s}tbody tr:hover{background:rgba(79,195,247,0.05)}
tr.sel{background:rgba(79,195,247,0.15)}tr.top{background:rgba(74,222,128,0.06)}
.uber{display:block}.gen{display:none}body.gm .uber{display:none}body.gm .gen{display:block}
.badge{background:rgba(79,195,247,0.3);color:var(--accent);font-size:0.65rem;padding:2px 6px;border-radius:4px;font-weight:700;margin-left:6px}
.tog{display:flex;align-items:center;gap:10px;background:var(--panel);padding:10px;border-radius:8px;margin-bottom:12px}
.tog input{width:44px;height:24px;appearance:none;background:var(--border);border-radius:12px;position:relative;cursor:pointer}
.tog input:checked{background:linear-gradient(135deg,#a78bfa,#4fc3f7)}
.tog input::before{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:#fff;top:3px;left:3px;transition:all 0.3s}
.tog input:checked::before{left:23px}.tog label{font-size:0.85rem;color:var(--text);cursor:pointer;font-weight:600}

/* –ú–æ–±–∏–ª–Ω–∏ —Å—Ç–∏–ª–æ–≤–µ */
body.mobile-mode{font-size:16px}
body.mobile-mode header{padding:12px 16px;flex-wrap:wrap}
body.mobile-mode .logo{width:40px;height:40px}
body.mobile-mode h1{font-size:1rem}
body.mobile-mode .actions{width:100%;margin-top:10px;flex-wrap:wrap}
body.mobile-mode .actions button{flex:1;min-width:calc(50% - 4px);font-size:0.85rem}
body.mobile-mode .main{display:flex;flex-direction:column;padding:12px;gap:14px}
body.mobile-mode .col{max-height:none;overflow-y:visible}
body.mobile-mode .card{padding:16px}
body.mobile-mode h3{font-size:1.05rem}
body.mobile-mode .input-group{margin-bottom:18px}
body.mobile-mode .input-head{font-size:0.95rem;margin-bottom:12px}
body.mobile-mode .val{font-size:1.05rem}
body.mobile-mode input[type=range]{height:40px;margin:10px 0;padding:8px 0}
body.mobile-mode input[type=range]::-webkit-slider-thumb{width:28px;height:28px}
body.mobile-mode input[type=range]::-moz-range-thumb{width:28px;height:28px}
body.mobile-mode .kpi{padding:16px;margin-bottom:14px}
body.mobile-mode .kpi .label{font-size:0.85rem;margin-bottom:8px}
body.mobile-mode .kpi .big{font-size:1.6rem}
body.mobile-mode .kpi .small{font-size:0.85rem}
body.mobile-mode .cities{grid-template-columns:1fr 1fr;gap:12px}
body.mobile-mode .city-chip{padding:14px;min-height:90px}
body.mobile-mode .city-name{font-size:1rem}
body.mobile-mode .city-info{font-size:0.85rem}
body.mobile-mode table{font-size:0.9rem}
body.mobile-mode th,body.mobile-mode td{padding:12px 10px}
body.mobile-mode .tog{padding:14px;margin-bottom:14px}
body.mobile-mode .tog input{width:52px;height:28px}
body.mobile-mode .tog input::before{width:22px;height:22px}
body.mobile-mode .tog input:checked::before{left:27px}
body.mobile-mode .tog label{font-size:0.95rem}
body.mobile-mode button{padding:12px 20px;font-size:0.95rem;min-height:48px}
body.mobile-mode .ghost{padding:10px 16px}
</style>
</head>
<body>
<header>
<div class="logo">üå±</div>
<div><h1>A Better Root Planting</h1></div>
<div class="actions">
<div class="lang-dropdown">
<button id="lng" class="ghost lang-btn">
<img src="https://flagcdn.com/w40/bg.png" class="flag" alt="BG" id="currentFlag">
<span id="currentLang">–ë—ä–ª–≥–∞—Ä—Å–∫–∏</span>
</button>
<div class="lang-menu" id="langMenu">
<div class="lang-option active" onclick="setLang(0, 'bg', '–ë—ä–ª–≥–∞—Ä—Å–∫–∏')">
<img src="https://flagcdn.com/w40/bg.png" class="flag" alt="BG">
<span>–ë—ä–ª–≥–∞—Ä—Å–∫–∏</span>
</div>
<div class="lang-option" onclick="setLang(1, 'gb', 'English')">
<img src="https://flagcdn.com/w40/gb.png" class="flag" alt="GB">
<span>English</span>
</div>
<div class="lang-option" onclick="setLang(2, 'de', 'Deutsch')">
<img src="https://flagcdn.com/w40/de.png" class="flag" alt="DE">
<span>Deutsch</span>
</div>
<div class="lang-option" onclick="setLang(3, 'es', 'Espa√±ol')">
<img src="https://flagcdn.com/w40/es.png" class="flag" alt="ES">
<span>Espa√±ol</span>
</div>
<div class="lang-option" onclick="setLang(4, 'fr', 'Fran√ßais')">
<img src="https://flagcdn.com/w40/fr.png" class="flag" alt="FR">
<span>Fran√ßais</span>
</div>
</div>
</div>
<button id="bm" class="ghost" data-i18n="modeBtn">üíº –û–±—â —Ä–µ–∂–∏–º</button>
<button id="mobBtn" class="ghost" data-i18n="mobileBtn">üì± –ú–æ–±–∏–ª–µ–Ω</button>
<button onclick="location.reload()" class="ghost" data-i18n="reload">‚Üª –ü—Ä–µ–∑–∞—Ä–µ–¥–∏</button>
</div>
</header>
<div class="main">
<div class="col">
<div class="card"><h3 data-i18n="familyTitle">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–µ–º–µ–π—Å—Ç–≤–æ</h3>
<div class="input-group"><div class="input-head"><span data-i18n="adults">–í—ä–∑—Ä–∞—Å—Ç–Ω–∏</span><span class="val" id="va">2</span></div><input id="sa" type="range" min="1" max="4" value="2"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="children">–î–µ—Ü–∞</span><span class="val" id="vk">3</span></div><input id="sk" type="range" min="0" max="6" value="3"/></div>
</div>
<div class="card"><h3 data-i18n="expensesTitle">üí∞ –†–∞–∑—Ö–æ–¥–∏</h3>
<div class="input-group"><div class="input-head"><span data-i18n="rent">–ù–∞–µ–º<span class="badge" id="ar" style="display:none">AUTO</span></span><span class="val neg" id="vr">-2000 ‚Ç¨</span></div><input id="sr" type="range" min="0" max="12000" value="2000" step="50"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="household">–î–æ–º–∞–∫–∏–Ω—Å—Ç–≤–æ<span class="badge" id="ah" style="display:none">AUTO</span></span><span class="val neg" id="vh">-1500 ‚Ç¨</span></div><input id="sh" type="range" min="0" max="8000" value="1500" step="50"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="healthAdults">–ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ –í—ä–∑—Ä–∞—Å—Ç–Ω–∏<span class="badge" id="aha" style="display:none">AUTO</span></span><span class="val neg" id="vha">-0 ‚Ç¨</span></div><input id="sha" type="range" min="0" max="800" value="0" step="10"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="healthChildren">–ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ –î–µ—Ü–∞<span class="badge" id="ahk" style="display:none">AUTO</span></span><span class="val neg" id="vhk">-0 ‚Ç¨</span></div><input id="shk" type="range" min="0" max="400" value="0" step="10"/></div>
</div>
<div class="card uber"><h3 data-i18n="incomeUberTitle">üíº –î–æ—Ö–æ–¥–∏ (Uber)</h3>
<div class="input-group"><div class="input-head"><span data-i18n="additional">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∏</span><span class="val" id="veu">0 ‚Ç¨</span></div><input id="seu" type="range" min="0" max="5000" value="0" step="50"/></div>
</div>
<div class="card gen"><h3 data-i18n="incomeTitle">üíº –î–æ—Ö–æ–¥–∏</h3>
<div class="input-group"><div class="input-head"><span data-i18n="salary">–ó–∞–ø–ª–∞—Ç–∞</span><span class="val" id="vs">5000 ‚Ç¨</span></div><input id="ss" type="range" min="1000" max="20000" value="5000" step="100"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="additional">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∏</span><span class="val" id="ve">0 ‚Ç¨</span></div><input id="se" type="range" min="0" max="5000" value="0" step="50"/></div>
</div>
<div class="card uber"><h3 data-i18n="uberTitle">üöó Uber –ø–∞—Ä–∞–º–µ—Ç—Ä–∏</h3>
<div class="input-group"><div class="input-head"><span data-i18n="comfortPercent">üåü Uber Comfort –∫—É—Ä—Å–æ–≤–µ (%)</span><span class="val" id="vcf">0 %</span></div><input id="scf" type="range" min="0" max="100" value="0" step="5"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="workDays">–†–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏</span><span class="val" id="vw">22</span></div><input id="sw" type="range" min="16" max="26" value="22"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="kmDay">–ö–ú/–î–µ–Ω</span><span class="val" id="vl">220 –∫–º</span></div><input id="sl" type="range" min="100" max="500" value="220" step="10"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="euroKm">–ù–µ—Ç–æ ‚Ç¨/–ö–ú<span class="badge" id="akm" style="display:none">AUTO</span></span><span class="val" id="vkr">1.8 ‚Ç¨</span></div><input id="skr" type="range" min="0.5" max="8" value="1.8" step="0.1"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="emptyKm">–ü—Ä–∞–∑–Ω–∏ –∫–º (%)<span class="badge" id="aem" style="display:none">AUTO</span></span><span class="val" id="vem">8 %</span></div><input id="sem" type="range" min="0" max="40" value="8"/></div>
<div class="input-group"><div class="input-head"><span data-i18n="pension">–ü–µ–Ω—Å–∏—è (%)<span class="badge" id="ap" style="display:none">AUTO</span></span><span class="val" id="vp">5 %</span></div><input id="sp" type="range" min="0" max="15" value="5"/></div>
</div>
</div>
<div class="col">
<div class="card"><h3 data-i18n="rankingTitle">üìä –ö–ª–∞—Å–∞—Ü–∏—è –≥—Ä–∞–¥–æ–≤–µ</h3>
<div style="overflow:auto;max-height:calc(100vh - 200px)"><table><thead><tr><th data-i18n="city">–ì—Ä–∞–¥</th><th data-i18n="rentRange">–ù–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω</th><th data-i18n="taxCol">–î–∞–Ω—ä–∫</th><th data-i18n="schools">–£—á–∏–ª–∏—â–∞</th><th data-i18n="quality">–ö–∞—á–µ—Å—Ç–≤–æ</th><th data-i18n="result">–†–µ–∑—É–ª—Ç–∞—Ç</th></tr></thead><tbody id="tb"></tbody></table></div>
</div>
</div>
<div class="col">
<div class="card"><h3 data-i18n="top3Title">üèÜ –¢–æ–ø 3 –≥—Ä–∞–¥–∞</h3><div id="t3"></div></div>
<div class="card"><h3 data-i18n="allCitiesTitle">üåç –í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ</h3><div class="cities" id="ct"></div></div>
<div class="card"><h3 data-i18n="summaryTitle">üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞ —Å–≤–æ–¥–∫–∞</h3>
<div class="kpi"><div class="label" data-i18n="monthlyExpenses">–ú–µ—Å–µ—á–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏</div><div class="big" id="kex">‚Äî</div><div class="small" id="kexy">‚Äî</div></div>
<div class="kpi uber"><div class="label" data-i18n="uberIncome">Uber –ø—Ä–∏—Ö–æ–¥–∏</div><div class="big" id="kui">‚Äî</div><div class="small" id="kuiy">‚Äî</div></div>
<div class="kpi uber"><div class="label" data-i18n="totalIncomeUber">–û–±—â –¥–æ—Ö–æ–¥ (Uber —Ä–µ–∂–∏–º)</div><div class="big" id="ktiu">‚Äî</div><div class="small" id="ktiuy">‚Äî</div></div>
<div class="kpi gen"><div class="label" data-i18n="totalIncome">–û–±—â –¥–æ—Ö–æ–¥</div><div class="big" id="kti">‚Äî</div><div class="small" id="ktiy">‚Äî</div></div>
<div class="kpi"><div class="label" data-i18n="savings">üí∞ –°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è</div><div class="big" id="ksav">‚Äî</div><div class="small" id="ksavy">‚Äî</div></div>
<div class="kpi uber"><div class="label" data-i18n="netPerKm">–ù–µ—Ç–æ –ø—Ä–∏—Ö–æ–¥ –Ω–∞ –∫–∏–ª–æ–º–µ—Ç—ä—Ä</div><div class="big" id="knkm">‚Äî</div></div>
<div class="kpi uber"><div class="label" data-i18n="requiredKm">–ù–µ–æ–±—Ö–æ–¥–∏–º–∏ –ö–ú/–î–µ–Ω</div><div class="big" id="krq">‚Äî</div><div class="small" id="krqm">‚Äî</div></div>
</div>
</div>
</div>
<script>
const T = {
  bg: {
    modeBtn: 'üíº –û–±—â —Ä–µ–∂–∏–º', modeBtnAlt: 'üöó Uber —Ä–µ–∂–∏–º', reload: '‚Üª –ü—Ä–µ–∑–∞—Ä–µ–¥–∏',
    mobileBtn: 'üì± –ú–æ–±–∏–ª–µ–Ω', mobileBtnAlt: 'üñ•Ô∏è Desktop',
    familyTitle: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ –°–µ–º–µ–π—Å—Ç–≤–æ', adults: '–í—ä–∑—Ä–∞—Å—Ç–Ω–∏', children: '–î–µ—Ü–∞',
    expensesTitle: 'üí∞ –†–∞–∑—Ö–æ–¥–∏', rent: '–ù–∞–µ–º', household: '–î–æ–º–∞–∫–∏–Ω—Å—Ç–≤–æ',
    healthAdults: '–ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ –í—ä–∑—Ä–∞—Å—Ç–Ω–∏', healthChildren: '–ó–¥—Ä–∞–≤–Ω–æ –æ—Å–∏–≥—É—Ä—è–≤–∞–Ω–µ –î–µ—Ü–∞',
    incomeUberTitle: 'üíº –î–æ—Ö–æ–¥–∏ (Uber)', incomeTitle: 'üíº –î–æ—Ö–æ–¥–∏',
    salary: '–ó–∞–ø–ª–∞—Ç–∞', additional: '–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –ø—Ä–∏—Ö–æ–¥–∏',
    uberTitle: 'üöó Uber –ø–∞—Ä–∞–º–µ—Ç—Ä–∏', comfort: 'üåü Uber Comfort (+30% —Ç–∞—Ä–∏—Ñ–∞)',
    comfortPercent: 'üåü Uber Comfort –∫—É—Ä—Å–æ–≤–µ (%)',
    workDays: '–†–∞–±–æ—Ç–Ω–∏ –¥–Ω–∏', kmDay: '–ö–ú/–î–µ–Ω', baseFare: '–ë–∞–∑–æ–≤–∞ —Ç–∞–∫—Å–∞',
    euroKm: '–ù–µ—Ç–æ ‚Ç¨/–ö–ú', tax: '–î–∞–Ω—ä–∫ (%)', emptyKm: '–ü—Ä–∞–∑–Ω–∏ –∫–º (%)',
    pension: '–ü–µ–Ω—Å–∏—è (%)',
    rankingTitle: 'üìä –ö–ª–∞—Å–∞—Ü–∏—è –≥—Ä–∞–¥–æ–≤–µ', city: '–ì—Ä–∞–¥', rentRange: '–ù–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω',
    taxCol: '–î–∞–Ω—ä–∫', schools: '–£—á–∏–ª–∏—â–∞', quality: '–ö–∞—á–µ—Å—Ç–≤–æ', result: '–†–µ–∑—É–ª—Ç–∞—Ç',
    top3Title: 'üèÜ –¢–æ–ø 3 –≥—Ä–∞–¥–∞', allCitiesTitle: 'üåç –í—Å–∏—á–∫–∏ –≥—Ä–∞–¥–æ–≤–µ',
    summaryTitle: 'üìä –§–∏–Ω–∞–Ω—Å–æ–≤–∞ —Å–≤–æ–¥–∫–∞', monthlyExpenses: '–ú–µ—Å–µ—á–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏',
    uberIncome: 'Uber –ø—Ä–∏—Ö–æ–¥–∏', totalIncomeUber: '–û–±—â –¥–æ—Ö–æ–¥ (Uber —Ä–µ–∂–∏–º)',
    totalIncome: '–û–±—â –¥–æ—Ö–æ–¥', savings: 'üí∞ –°–ø–µ—Å—Ç—è–≤–∞–Ω–∏—è',
    netPerKm: '–ù–µ—Ç–æ –ø—Ä–∏—Ö–æ–¥ –Ω–∞ –∫–∏–ª–æ–º–µ—Ç—ä—Ä', requiredKm: '–ù–µ–æ–±—Ö–æ–¥–∏–º–∏ –ö–ú/–î–µ–Ω',
    perYear: '/–≥–æ–¥–∏–Ω–∞', perMonth: '/–º–µ—Å–µ—Ü'
  },
  en: {
    modeBtn: 'üíº General Mode', modeBtnAlt: 'üöó Uber Mode', reload: '‚Üª Reload',
    mobileBtn: 'üì± Mobile', mobileBtnAlt: 'üñ•Ô∏è Desktop',
    familyTitle: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family', adults: 'Adults', children: 'Children',
    expensesTitle: 'üí∞ Expenses', rent: 'Rent', household: 'Household',
    healthAdults: 'Health Insurance Adults', healthChildren: 'Health Insurance Children',
    incomeUberTitle: 'üíº Income (Uber)', incomeTitle: 'üíº Income',
    salary: 'Salary', additional: 'Additional Income',
    uberTitle: 'üöó Uber Parameters', comfort: 'üåü Uber Comfort (+30% rate)',
    comfortPercent: 'üåü Uber Comfort rides (%)',
    workDays: 'Work Days', kmDay: 'KM/Day', baseFare: 'Base Fare',
    euroKm: 'Net ‚Ç¨/KM', tax: 'Tax (%)', emptyKm: 'Empty KM (%)',
    pension: 'Pension (%)',
    rankingTitle: 'üìä City Rankings', city: 'City', rentRange: 'Rent Range',
    taxCol: 'Tax', schools: 'Schools', quality: 'Quality', result: 'Result',
    top3Title: 'üèÜ Top 3 Cities', allCitiesTitle: 'üåç All Cities',
    summaryTitle: 'üìä Financial Summary', monthlyExpenses: 'Monthly Expenses',
    uberIncome: 'Uber Income', totalIncomeUber: 'Total Income (Uber Mode)',
    totalIncome: 'Total Income', savings: 'üí∞ Savings',
    netPerKm: 'Net Income per KM', requiredKm: 'Required KM/Day',
    perYear: '/year', perMonth: '/month'
  },
  de: {
    modeBtn: 'üíº Allgemein Modus', modeBtnAlt: 'üöó Uber Modus', reload: '‚Üª Neuladen',
    mobileBtn: 'üì± Mobil', mobileBtnAlt: 'üñ•Ô∏è Desktop',
    familyTitle: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familie', adults: 'Erwachsene', children: 'Kinder',
    expensesTitle: 'üí∞ Ausgaben', rent: 'Miete', household: 'Haushalt',
    healthAdults: 'Krankenversicherung Erwachsene', healthChildren: 'Krankenversicherung Kinder',
    incomeUberTitle: 'üíº Einkommen (Uber)', incomeTitle: 'üíº Einkommen',
    salary: 'Gehalt', additional: 'Zus√§tzliches Einkommen',
    uberTitle: 'üöó Uber Parameter', comfort: 'üåü Uber Comfort (+30% Tarif)',
    comfortPercent: 'üåü Uber Comfort Fahrten (%)',
    workDays: 'Arbeitstage', kmDay: 'KM/Tag', baseFare: 'Grundgeb√ºhr',
    euroKm: 'Netto ‚Ç¨/KM', tax: 'Steuer (%)', emptyKm: 'Leer-KM (%)',
    pension: 'Rente (%)',
    rankingTitle: 'üìä Stadt-Rangliste', city: 'Stadt', rentRange: 'Mietbereich',
    taxCol: 'Steuer', schools: 'Schulen', quality: 'Qualit√§t', result: 'Ergebnis',
    top3Title: 'üèÜ Top 3 St√§dte', allCitiesTitle: 'üåç Alle St√§dte',
    summaryTitle: 'üìä Finanz√ºbersicht', monthlyExpenses: 'Monatliche Ausgaben',
    uberIncome: 'Uber Einkommen', totalIncomeUber: 'Gesamteinkommen (Uber Modus)',
    totalIncome: 'Gesamteinkommen', savings: 'üí∞ Ersparnisse',
    netPerKm: 'Nettoeinkommen pro KM', requiredKm: 'Erforderliche KM/Tag',
    perYear: '/Jahr', perMonth: '/Monat'
  },
  es: {
    modeBtn: 'üíº Modo General', modeBtnAlt: 'üöó Modo Uber', reload: '‚Üª Recargar',
    mobileBtn: 'üì± M√≥vil', mobileBtnAlt: 'üñ•Ô∏è Desktop',
    familyTitle: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Familia', adults: 'Adultos', children: 'Ni√±os',
    expensesTitle: 'üí∞ Gastos', rent: 'Alquiler', household: 'Hogar',
    healthAdults: 'Seguro de Salud Adultos', healthChildren: 'Seguro de Salud Ni√±os',
    incomeUberTitle: 'üíº Ingresos (Uber)', incomeTitle: 'üíº Ingresos',
    salary: 'Salario', additional: 'Ingresos Adicionales',
    uberTitle: 'üöó Par√°metros Uber', comfort: 'üåü Uber Comfort (+30% tarifa)',
    comfortPercent: 'üåü Viajes Uber Comfort (%)',
    workDays: 'D√≠as Laborables', kmDay: 'KM/D√≠a', baseFare: 'Tarifa Base',
    euroKm: 'Neto ‚Ç¨/KM', tax: 'Impuesto (%)', emptyKm: 'KM Vac√≠os (%)',
    pension: 'Pensi√≥n (%)',
    rankingTitle: 'üìä Clasificaci√≥n de Ciudades', city: 'Ciudad', rentRange: 'Rango de Alquiler',
    taxCol: 'Impuesto', schools: 'Escuelas', quality: 'Calidad', result: 'Resultado',
    top3Title: 'üèÜ Top 3 Ciudades', allCitiesTitle: 'üåç Todas las Ciudades',
    summaryTitle: 'üìä Resumen Financiero', monthlyExpenses: 'Gastos Mensuales',
    uberIncome: 'Ingresos Uber', totalIncomeUber: 'Ingreso Total (Modo Uber)',
    totalIncome: 'Ingreso Total', savings: 'üí∞ Ahorros',
    netPerKm: 'Ingreso Neto por KM', requiredKm: 'KM Requeridos/D√≠a',
    perYear: '/a√±o', perMonth: '/mes'
  },
  fr: {
    modeBtn: 'üíº Mode G√©n√©ral', modeBtnAlt: 'üöó Mode Uber', reload: '‚Üª Recharger',
    mobileBtn: 'üì± Mobile', mobileBtnAlt: 'üñ•Ô∏è Desktop',
    familyTitle: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Famille', adults: 'Adultes', children: 'Enfants',
    expensesTitle: 'üí∞ D√©penses', rent: 'Loyer', household: 'M√©nage',
    healthAdults: 'Assurance Sant√© Adultes', healthChildren: 'Assurance Sant√© Enfants',
    incomeUberTitle: 'üíº Revenus (Uber)', incomeTitle: 'üíº Revenus',
    salary: 'Salaire', additional: 'Revenus Suppl√©mentaires',
    uberTitle: 'üöó Param√®tres Uber', comfort: 'üåü Uber Comfort (+30% tarif)',
    comfortPercent: 'üåü Courses Uber Comfort (%)',
    workDays: 'Jours Ouvrables', kmDay: 'KM/Jour', baseFare: 'Tarif de Base',
    euroKm: 'Net ‚Ç¨/KM', tax: 'Imp√¥t (%)', emptyKm: 'KM √† Vide (%)',
    pension: 'Pension (%)',
    rankingTitle: 'üìä Classement des Villes', city: 'Ville', rentRange: 'Gamme de Loyer',
    taxCol: 'Imp√¥t', schools: '√âcoles', quality: 'Qualit√©', result: 'R√©sultat',
    top3Title: 'üèÜ Top 3 Villes', allCitiesTitle: 'üåç Toutes les Villes',
    summaryTitle: 'üìä R√©sum√© Financier', monthlyExpenses: 'D√©penses Mensuelles',
    uberIncome: 'Revenus Uber', totalIncomeUber: 'Revenu Total (Mode Uber)',
    totalIncome: 'Revenu Total', savings: 'üí∞ √âconomies',
    netPerKm: 'Revenu Net par KM', requiredKm: 'KM Requis/Jour',
    perYear: '/an', perMonth: '/mois'
  }
};

const LANGS = ['bg', 'en', 'de', 'es', 'fr'];
const S={a:2,k:3,r:2000,h:1500,ha:0,hk:0,e:0,eu:0,s:5000,w:22,l:220,kr:0.8,em:8,p:5,cf:0,m:true,sel:null,lg:0,mob:false};
const D={
Zurich:{n:'Z√ºrich',c:'ch',rm:2500,rx:6000,ar:4000,hh:600,sc:5,bf:6,pk:1.2,tr:20,ek:3,ha:400,hk:200,pe:5},
Zug:{n:'Zug',c:'ch',rm:2600,rx:6500,ar:4200,hh:620,sc:5,bf:6,pk:1.2,tr:18,ek:2,ha:400,hk:200,pe:5},
Geneva:{n:'Geneva',c:'ch',rm:2400,rx:5500,ar:3800,hh:600,sc:4,bf:6,pk:1.1,tr:22,ek:4,ha:400,hk:200,pe:5},
Oslo:{n:'Oslo',c:'no',rm:1900,rx:3600,ar:2600,hh:520,sc:5,bf:5,pk:1.0,tr:32,ek:7,ha:0,hk:0,pe:4},
Berlin:{n:'Berlin',c:'de',rm:1500,rx:3200,ar:2200,hh:450,sc:4,bf:3.9,pk:0.75,tr:25,ek:9,ha:0,hk:0,pe:4},
Munich:{n:'M√ºnchen',c:'de',rm:2000,rx:4500,ar:3000,hh:500,sc:5,bf:4.5,pk:0.9,tr:27,ek:7,ha:0,hk:0,pe:4},
Vienna:{n:'Wien',c:'at',rm:1500,rx:3000,ar:2100,hh:450,sc:5,bf:3.4,pk:0.7,tr:30,ek:8,ha:0,hk:0,pe:5},
Amsterdam:{n:'Amsterdam',c:'nl',rm:2200,rx:4000,ar:2900,hh:500,sc:4,bf:3.5,pk:0.75,tr:38,ek:9,ha:0,hk:0,pe:6},
Paris:{n:'Paris',c:'fr',rm:1800,rx:4200,ar:2700,hh:480,sc:4,bf:3.8,pk:0.7,tr:32,ek:10,ha:0,hk:0,pe:5},
London:{n:'London',c:'gb',rm:2800,rx:6000,ar:4000,hh:550,sc:4,bf:3.5,pk:0.7,tr:30,ek:12,ha:0,hk:0,pe:5},
Madrid:{n:'Madrid',c:'es',rm:1200,rx:2600,ar:1800,hh:400,sc:4,bf:2.8,pk:0.5,tr:25,ek:11,ha:0,hk:0,pe:4},
Barcelona:{n:'Barcelona',c:'es',rm:1400,rx:2900,ar:2000,hh:420,sc:4,bf:3,pk:0.55,tr:26,ek:10,ha:0,hk:0,pe:4},
Lisbon:{n:'Lisboa',c:'pt',rm:1100,rx:2400,ar:1600,hh:380,sc:4,bf:2.5,pk:0.45,tr:28,ek:10,ha:0,hk:0,pe:4},
Rome:{n:'Roma',c:'it',rm:1400,rx:3000,ar:2000,hh:420,sc:3,bf:3,pk:0.55,tr:32,ek:11,ha:0,hk:0,pe:4},
Prague:{n:'Praha',c:'cz',rm:1200,rx:2400,ar:1700,hh:380,sc:4,bf:1.8,pk:0.35,tr:23,ek:8,ha:0,hk:0,pe:5},
Warsaw:{n:'Warszawa',c:'pl',rm:1100,rx:2200,ar:1500,hh:350,sc:4,bf:2,pk:0.35,tr:17,ek:9,ha:0,hk:0,pe:6},
Budapest:{n:'Budapest',c:'hu',rm:1000,rx:2100,ar:1400,hh:340,sc:4,bf:1.7,pk:0.3,tr:15,ek:10,ha:0,hk:0,pe:6},
Sofia:{n:'–°–æ—Ñ–∏—è',c:'bg',rm:800,rx:1500,ar:1100,hh:300,sc:3,bf:1.5,pk:0.28,tr:10,ek:12,ha:0,hk:0,pe:5}
};

function translateUI() {
    const lang = LANGS[S.lg];
    const trans = T[lang];
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (trans[key]) {
            if (el.tagName === 'LABEL') {
                el.textContent = trans[key];
            } else {
                const badge = el.querySelector('.badge');
                el.childNodes.forEach(node => {
                    if (node.nodeType === 3) {
                        node.textContent = trans[key];
                    }
                });
            }
        }
    });
    const modeBtn = document.getElementById('bm');
    modeBtn.textContent = S.m ? trans.modeBtn : trans.modeBtnAlt;
    const mobBtn = document.getElementById('mobBtn');
    mobBtn.textContent = S.mob ? trans.mobileBtnAlt : trans.mobileBtn;
}

function setLang(idx, code, name) {
    S.lg = idx;
    document.getElementById('currentFlag').src = `https://flagcdn.com/w40/${code}.png`;
    document.getElementById('currentLang').textContent = name;
    document.querySelectorAll('.lang-option').forEach((el, i) => {
        el.classList.toggle('active', i === idx);
    });
    document.getElementById('langMenu').classList.remove('show');
    translateUI();
    up();
}

document.getElementById('lng').onclick = (e) => {
    e.stopPropagation();
    document.getElementById('langMenu').classList.toggle('show');
};

document.addEventListener('click', () => {
    document.getElementById('langMenu').classList.remove('show');
});

const fm=n=>Math.round(n).toLocaleString('bg-BG');
function uv(p){const v=document.getElementById('v'+p);if(!v)return;
if(p==='t'||p==='p'||p==='em'||p==='cf')v.textContent=S[p]+' %';
else if(p==='a'||p==='k'||p==='w')v.textContent=S[p];
else if(p==='l')v.textContent=S[p]+' –∫–º';
else if(p==='kr')v.textContent=S[p].toFixed(2)+' ‚Ç¨';
else if(p==='s'||p==='su'||p==='e'||p==='eu')v.textContent=fm(S[p])+' ‚Ç¨';
else v.textContent='-'+fm(S[p])+' ‚Ç¨';}
function ld(k){S.sel=k;const d=D[k];S.r=d.ar;S.h=d.hh*Math.max(S.a+S.k,1);S.t=d.tr;S.ha=d.ha;S.hk=d.hk;S.p=d.pe;
// –ö–æ–ª–∫–æ—Ç–æ –ø–æ-–≤–∏—Å–æ–∫ –µ –Ω–∞–µ–º—ä—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∑–∞ –≥—Ä–∞–¥–∞, —Ç–æ–ª–∫–æ–≤–∞ –ø–æ-–±–ª–∏–∑–æ –¥–æ —Ü–µ–Ω—Ç—ä—Ä–∞ —Å–º–µ
const rng=d.rx-d.rm; // –î–∏–∞–ø–∞–∑–æ–Ω –Ω–∞ –Ω–∞–µ–º–∞ –∑–∞ –≥—Ä–∞–¥–∞
const rpos=(S.r-d.rm)/rng; // –ü–æ–∑–∏—Ü–∏—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (0=–µ–≤—Ç–∏–Ω–æ/–¥–∞–ª–µ—á–µ, 1=—Å–∫—ä–ø–æ/—Ü–µ–Ω—Ç—ä—Ä)
const clamp=Math.max(0,Math.min(1,rpos)); // –û–≥—Ä–∞–Ω–∏—á–∞–≤–∞–º–µ –º–µ–∂–¥—É 0 –∏ 1
// –í —Ü–µ–Ω—Ç—ä—Ä–∞: –ø–æ-–º–∞–ª–∫–æ –ø—Ä–∞–∑–Ω–∏ –∫–º (–ø–æ-–≤–∏—Å–æ–∫–∞ clamp -> –ø–æ-–º–∞–ª–∫–æ ek)
S.em=Math.round(d.ek*(1.5-clamp*0.8)); // –û—Ç 150% –¥–æ 70% –æ—Ç –±–∞–∑–æ–≤–∏—Ç–µ –ø—Ä–∞–∑–Ω–∏ –∫–º
// –í —Ü–µ–Ω—Ç—ä—Ä–∞: –ø–æ-–≤–∏—Å–æ–∫–∞ –ø–µ—á–∞–ª–±–∞ –Ω–∞ –∫–º (–ø–æ-–≤–∏—Å–æ–∫–∞ clamp -> –ø–æ-–≤–∏—Å–æ–∫–∞ pk)
S.kr=+(d.pk*(0.5+clamp*1.2)).toFixed(2); // –û—Ç 50% –¥–æ 170% –æ—Ç –±–∞–∑–æ–≤–∞—Ç–∞ –ø–µ—á–∞–ª–±–∞
['r','h','kr','em','ha','hk','p'].forEach(p=>{const sl=document.getElementById('s'+p);if(sl)sl.value=S[p];uv(p);});
['ar','ah','akm','aem','aha','ahk','ap'].forEach(id=>{const el=document.getElementById(id);if(el)el.style.display='inline-block';});up();}
function up(){const trans=T[LANGS[S.lg]];const ex=S.r+S.h+S.ha*S.a+S.hk*S.k;
document.getElementById('kex').textContent=fm(ex)+' ‚Ç¨';
document.getElementById('kexy').textContent=fm(ex*12)+' ‚Ç¨'+trans.perYear;
if(S.m){
// S.kr –≤–µ—á–µ –µ –ù–ï–¢–û –ø—Ä–∏—Ö–æ–¥ –Ω–∞ –∫–º —Å–ª–µ–¥ Uber —Ç–∞–∫—Å–∞ (25%) –∏ –¥–∞–Ω—ä—Ü–∏
// Uber Comfort –∫—É—Ä—Å–æ–≤–µ—Ç–µ –Ω–æ—Å—è—Ç 30% –ø–æ–≤–µ—á–µ (—Å—Ä–µ–¥–Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –º–µ–∂–¥—É 20-40%)
const comfortBonus = 1 + (S.cf / 100) * 0.30; // –ù–∞–ø—Ä–∏–º–µ—Ä: 50% Comfort = 1.15x (15% –ø–æ–≤–µ—á–µ –æ–±—â–æ)
const krAdjusted = S.kr * comfortBonus;
// –¢—Ä—è–±–≤–∞ —Å–∞–º–æ –¥–∞ –ø—Ä–∏–ª–æ–∂–∏–º –ø—Ä–∞–∑–Ω–∏—Ç–µ –∫–º –∏ –ø–µ–Ω—Å–∏—è—Ç–∞
const rn=krAdjusted*Math.max(0.5,1-S.em/100)*(1-S.p/100);  // –ù–µ—Ç–æ —Å–ª–µ–¥ –ø—Ä–∞–∑–Ω–∏ –∫–º –∏ –ø–µ–Ω—Å–∏—è
const ui=rn*S.l*S.w;  // –ú–µ—Å–µ—á–µ–Ω Uber –¥–æ—Ö–æ–¥ = –Ω–µ—Ç–æ_–∫–º * –∫–º_–¥–µ–Ω * —Ä–∞–±–æ—Ç–Ω–∏_–¥–Ω–∏
document.getElementById('kui').textContent=fm(ui)+' ‚Ç¨';document.getElementById('kuiy').textContent=fm(ui*12)+' ‚Ç¨'+trans.perYear;const ti=ui+S.eu;
document.getElementById('ktiu').textContent=fm(ti)+' ‚Ç¨';document.getElementById('ktiuy').textContent=fm(ti*12)+' ‚Ç¨'+trans.perYear;const sv=ti-ex;
document.getElementById('ksav').textContent=fm(sv)+' ‚Ç¨';document.getElementById('ksavy').textContent=fm(sv*12)+' ‚Ç¨'+trans.perYear;
const sk=document.querySelector('.kpi:has(#ksav)');if(sv>0){sk.classList.add('pos');sk.classList.remove('neg');}else{sk.classList.add('neg');sk.classList.remove('pos');}
document.getElementById('knkm').textContent=rn>0?rn.toFixed(2)+' ‚Ç¨':'‚Äî';const rq=rn>0?ex/rn/S.w:999;
document.getElementById('krq').textContent=rq<999?fm(rq)+' –∫–º':'>500 –∫–º';document.getElementById('krqm').textContent=rq<999?fm(rq*S.w)+' –∫–º'+trans.perMonth:'';}
else{const ti=S.s+S.e;document.getElementById('kti').textContent=fm(ti)+' ‚Ç¨';document.getElementById('ktiy').textContent=fm(ti*12)+' ‚Ç¨'+trans.perYear;const sv=ti-ex;
document.getElementById('ksav').textContent=fm(sv)+' ‚Ç¨';document.getElementById('ksavy').textContent=fm(sv*12)+' ‚Ç¨'+trans.perYear;
const sk=document.querySelector('.kpi:has(#ksav)');if(sv>0){sk.classList.add('pos');sk.classList.remove('neg');}else{sk.classList.add('neg');sk.classList.remove('pos');}}
const rs=Object.keys(D).map(k=>{const d=D[k];const ro=S.r>=d.rm&&S.r<=d.rx;const q=Math.round((d.sc/5)*100);let sc=q,km=0,st='ok';
if(S.m){
const rn=d.pk*Math.max(0.5,1-S.em/100)*(1-d.pe/100);  // –ù–µ—Ç–æ –Ω–∞ –∫–º –∑–∞ —Ç–æ–∑–∏ –≥—Ä–∞–¥
km=rn>0?ex/rn/S.w:999;
const kmOk=km<=S.l; // Kilometrite —Å–∞ –ø—Ä–∏–µ–º–ª–∏–≤–∏
const budgetOk=S.l*S.w*rn-ex>0; // –ë—é–¥–∂–µ—Ç—ä—Ç –µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª–µ–Ω
sc=kmOk?(100-km/S.l*30+q*0.3):q*0.5;
st=kmOk&&budgetOk&&ro?'ok':(!kmOk||!budgetOk)?'bad':'warn';
}
else{const ti=S.s+S.e;const af=ex<=ti;sc=(q*0.5+(ro?50:0)+(af?50:0))/2;st=ro&&af?'ok':ro||af?'warn':'bad';}
return{k,d,sc,km,st,q};});rs.sort((a,b)=>b.sc-a.sc);
document.getElementById('t3').innerHTML=rs.slice(0,3).map((x,i)=>`<div style="background:rgba(79,195,247,0.05);border:2px solid ${i===0?'#ffd700':i===1?'#c0c0c0':'#cd7f32'};border-radius:10px;padding:12px;margin-bottom:10px"><strong><img src="https://flagcdn.com/w40/${x.d.c}.png" class="flag" style="vertical-align:middle;margin-right:6px"> ${x.d.n}</strong><div style="display:flex;justify-content:space-between;margin-top:8px;font-size:0.8rem"><span>${trans.result}: ${Math.round(x.sc)}</span><span>${trans.taxCol}: ${x.d.tr}%</span></div></div>`).join('');
document.getElementById('ct').innerHTML=rs.map(x=>`<div class="city-chip ${x.st}${S.sel===x.k?' active':''}" onclick="ld('${x.k}')"><div class="city-name"><img src="https://flagcdn.com/w40/${x.d.c}.png" class="flag"> ${x.d.n}</div><div class="city-info">${trans.result}: ${Math.round(x.sc)}</div></div>`).join('');
document.getElementById('tb').innerHTML=rs.map((x,i)=>`<tr class="${S.sel===x.k?'sel':''}${i<3?' top':''}" onclick="ld('${x.k}')"><td><strong><img src="https://flagcdn.com/w40/${x.d.c}.png" class="flag" style="vertical-align:middle;margin-right:6px"> ${x.d.n}</strong></td><td>${fm(x.d.rm)}-${fm(x.d.rx)} ‚Ç¨</td><td>${x.d.tr}%</td><td>${x.d.sc}/5</td><td>${x.q}%</td><td><strong>${Math.round(x.sc)}</strong></td></tr>`).join('');}
['a','k','h','ha','hk','e','eu','s','w','l','kr','em','p','cf'].forEach(p=>{const sl=document.getElementById('s'+p);if(sl)sl.oninput=()=>{S[p]=+sl.value;uv(p);up();};});
// –ö–æ–≥–∞—Ç–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—è—Ç –ø—Ä–æ–º–µ–Ω—è –Ω–∞–µ–º–∞ —Ä—ä—á–Ω–æ, –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–∞–º–µ –ø—Ä–∞–∑–Ω–∏—Ç–µ –∫–º –∏ –ø–µ—á–∞–ª–±–∞—Ç–∞ –Ω–∞ –∫–º
document.getElementById('sr').oninput=()=>{
S.r=+document.getElementById('sr').value;
uv('r');
if(S.sel&&D[S.sel]){
const d=D[S.sel];const rng=d.rx-d.rm;const rpos=(S.r-d.rm)/rng;const clamp=Math.max(0,Math.min(1,rpos));
// –ï–≤—Ç–∏–Ω –Ω–∞–µ–º (–¥–∞–ª–µ—á–µ –æ—Ç —Ü–µ–Ω—Ç—ä—Ä–∞) -> –ø–æ–≤–µ—á–µ –ø—Ä–∞–∑–Ω–∏ –∫–º, –ø–æ-–Ω–∏—Å–∫–∞ –ø–µ—á–∞–ª–±–∞
// –°–∫—ä–ø –Ω–∞–µ–º (–≤ —Ü–µ–Ω—Ç—ä—Ä–∞) -> –ø–æ-–º–∞–ª–∫–æ –ø—Ä–∞–∑–Ω–∏ –∫–º, –ø–æ-–≤–∏—Å–æ–∫–∞ –ø–µ—á–∞–ª–±–∞
S.em=Math.round(d.ek*(1.5-clamp*0.8));S.kr=+(d.pk*(0.5+clamp*1.2)).toFixed(2);
document.getElementById('sem').value=S.em;uv('em');
document.getElementById('skr').value=S.kr;uv('kr');
}
up();
};
document.getElementById('bm').onclick=()=>{S.m=!S.m;document.body.classList.toggle('gm');const trans=T[LANGS[S.lg]];document.getElementById('bm').textContent=S.m?trans.modeBtn:trans.modeBtnAlt;up();};

// –ú–æ–±–∏–ª–µ–Ω –±—É—Ç–æ–Ω
document.getElementById('mobBtn').onclick=()=>{
    S.mob=!S.mob;
    document.body.classList.toggle('mobile-mode');
    const trans=T[LANGS[S.lg]];
    document.getElementById('mobBtn').textContent=S.mob?trans.mobileBtnAlt:trans.mobileBtn;
};

// –ó–∞—â–∏—Ç–∞ —Å—Ä–µ—â—É —Å–ª—É—á–∞–π–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –ø–ª—ä–∑–≥–∞—á–∏—Ç–µ –ø—Ä–∏ —Å–∫—Ä–æ–ª–≤–∞–Ω–µ
let isScrolling = false;
let scrollTimer = null;
let activeSlider = null;

window.addEventListener('scroll', () => {
    isScrolling = true;
    clearTimeout(scrollTimer);
    scrollTimer = setTimeout(() => {
        isScrolling = false;
    }, 150);
}, true);

document.querySelectorAll('input[type="range"]').forEach(slider => {
    let isDragging = false;
    let startValue = null;
    let touchStartY = 0;
    const parent = slider.closest('.input-group');
    
    slider.addEventListener('touchstart', (e) => {
        if (isScrolling) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        touchStartY = e.touches[0].clientY;
        isDragging = true;
        startValue = slider.value;
        activeSlider = slider;
        if(parent) parent.classList.add('active');
    }, {passive: false});
    
    slider.addEventListener('touchmove', (e) => {
        if (!isDragging) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
        const touchMoveY = e.touches[0].clientY;
        const deltaY = Math.abs(touchMoveY - touchStartY);
        
        // –ê–∫–æ –¥–≤–∏–∂–µ–Ω–∏–µ—Ç–æ –µ –ø—Ä–µ–¥–∏–º–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–Ω–æ (—Å–∫—Ä–æ–ª–≤–∞–Ω–µ), –æ—Ç–º–µ–Ω—è–º–µ –ø—Ä–æ–º—è–Ω–∞—Ç–∞
        if (deltaY > 10 && !activeSlider) {
            isDragging = false;
            if(parent) parent.classList.remove('active');
            return false;
        }
    }, {passive: false});
    
    slider.addEventListener('touchend', () => {
        isDragging = false;
        startValue = null;
        activeSlider = null;
        if(parent) parent.classList.remove('active');
    });
    
    slider.addEventListener('mousedown', () => {
        isDragging = true;
        startValue = slider.value;
        if(parent) parent.classList.add('active');
    });
    
    slider.addEventListener('mouseup', () => {
        isDragging = false;
        startValue = null;
        if(parent) parent.classList.remove('active');
    });
    
    slider.addEventListener('mouseleave', () => {
        if(isDragging) {
            isDragging = false;
            if(parent) parent.classList.remove('active');
        }
    });
});

window.ld=ld;window.setLang=setLang;up();
</script>
</body>
</html>